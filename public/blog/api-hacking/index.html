<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>API Hacking | My New Hugo Site</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="Learn how to collect data directly from source with this walkthrough of a website dissection.">
<meta name="generator" content="Hugo 0.91.2" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />







  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">←</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">API Hacking</h1>

    <div class="tip">
        <time datetime="2017-03-16 00:00:00 -0500 -0500">Mar 16, 2017</time>
        <span class="split">
          ·
        </span>
        <span>
          585 words
        </span>
        <span class="split">
          ·
        </span>
        <span>
          3 minute read
        </span>
    </div>

    
    


    <div class="content">
      <p>In preparation for a <a href="https://www.spartan.com/" target="_blank" rel="noopener">Spartan Sprint</a> in 2016, I subscribed to their &ldquo;Workout of the Day.&rdquo; I wanted to pull it up on my phone without having to go to their website or search through my inbox, so I took a closer look at the <a href="https://www.spartan.com/en/training/wods/spartan-wod" target="_blank" rel="noopener">Workout of the Day web page</a> and found an API link I might be able to use.</p>
<figure><img src="https://s3.amazonaws.com/dpfrakes/wod-request.png"
         alt="screenshot of workout of the day request"/><figcaption>
            <p>You shouldn&rsquo;t have to wait 13 seconds and download 10 MB of ads, images, and popups just to view 630 bytes of text.</p>
        </figcaption>
</figure>

<p>First, I searched through the Network tab in Developer Tools, looking for &ldquo;api&rdquo; or &ldquo;wod&rdquo; or some other single-link origin of the daily workout data. After filtering by XHR and peeking at the JSON responses to several requests, I found the following URL with everything I needed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">https://api.spartan.com/v6/api/get_page/?route<span style="color:#f92672">=</span>spartan.training.wod&amp;secondary<span style="color:#f92672">=</span>spartan-wod&amp;primary<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</code></pre></div><p>If you click on this request and view the HTTP response body, you&rsquo;ll see JSON that conveniently contains properly-formatted HTML for each daily workout for the current week, ready to be written straight to a webpage.</p>
<p>Copy that whole link and add it to your webpage&rsquo;s JS file as an AJAX request (code below uses <a href="https://api.jquery.com" target="_blank" rel="noopener">jQuery</a>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;https://api.spartan.com/v6/api/get_page/?route=spartan.training.wod&amp;secondary=spartan-wod&amp;primary=1&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) {
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Retrieved this data from API:&#39;</span>);
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">data</span>);
});
</code></pre></div><p>After successfully retrieving this data, I needed to whittle down the results to find just the workout for a particular day:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;https://api.spartan.com/v6/api/get_page/?route=spartan.training.wod&amp;secondary=spartan-wod&amp;primary=1&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">workoutHtml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">wods</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">post_content</span>;
  document.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">workoutHtml</span>);
});
</code></pre></div><p>This should replace whatever is currently on your webpage with the Workout of the Day for Sunday (&ldquo;Day 0&rdquo;) of this week. To find the current day of the week, I just needed to use the native <code>Date().getDay()</code> functionality:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;https://api.spartan.com/v6/api/get_page/?route=spartan.training.wod&amp;secondary=spartan-wod&amp;primary=1&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">dayOfWeek</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">new</span> Date()).<span style="color:#a6e22e">getDay</span>();
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">workoutHtml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">wods</span>[<span style="color:#a6e22e">dayOfWeek</span>].<span style="color:#a6e22e">post_content</span>;
  document.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">workoutHtml</span>);
});
</code></pre></div><p>After modifying the callback function to find the workout for the current day of the week, I was pretty satisfied just loading this every day for a while, but realized I could easily optimize it a bit. The first things to go were the unnecessary images.</p>
<p>To conserve screen real estate, and more importantly, decrease data usage, I sabotaged the image requests by changing their filenames before the browser could load them:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;https://api.spartan.com/v6/api/get_page/?route=spartan.training.wod&amp;secondary=spartan-wod&amp;primary=1&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">dayOfWeek</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">new</span> Date()).<span style="color:#a6e22e">getDay</span>();
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">workoutHtml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">wods</span>[<span style="color:#a6e22e">dayOfWeek</span>].<span style="color:#a6e22e">post_content</span>;
  <span style="color:#a6e22e">workoutHtml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">workoutHtml</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;jpg&#39;</span>).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;x&#39;</span>);
  <span style="color:#a6e22e">workoutHtml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">workoutHtml</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;png&#39;</span>).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;x&#39;</span>);
  document.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">workoutHtml</span>);
});
</code></pre></div><p>If you run the above script in a fresh browser page, you&rsquo;ll see the failed HTTP requests (403 Forbidden) for each image, as the browser tried to get <code>image.x</code> instead of <code>image.jpg</code>. Additionally, you&rsquo;ll notice a significant decrease in data transferred, as the images are several KB each, whereas 403 responses cost just a few bytes each.</p>
<p>A final cosmetic touch to this lightweight Workout of the Day was to hide the resulting broken images on the page. A simple DOM removal fixes this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;https://api.spartan.com/v6/api/get_page/?route=spartan.training.wod&amp;secondary=spartan-wod&amp;primary=1&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">dayOfWeek</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">new</span> Date()).<span style="color:#a6e22e">getDay</span>();
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">workoutHtml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">wods</span>[<span style="color:#a6e22e">dayOfWeek</span>].<span style="color:#a6e22e">post_content</span>;
  <span style="color:#a6e22e">workoutHtml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">workoutHtml</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;jpg&#39;</span>).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;x&#39;</span>);
  <span style="color:#a6e22e">workoutHtml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">workoutHtml</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;png&#39;</span>).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;x&#39;</span>);
  document.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">workoutHtml</span>);
  <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#39;img&#39;</span>).<span style="color:#a6e22e">hide</span>();
});
</code></pre></div><p>Finally, to isolate this as its own webpage, I created a simple HTML file with no content, added the above code in a <code>&lt;script&gt;</code> tag, then <a href="http://youmightnotneedjquery.com/" target="_blank" rel="noopener">refactored to not even require jQuery</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">html</span>&gt;
&lt;<span style="color:#f92672">head</span>&gt;&lt;/<span style="color:#f92672">head</span>&gt;
&lt;<span style="color:#f92672">body</span>&gt;
  &lt;<span style="color:#f92672">script</span>&gt;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">request</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>();
  <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#39;GET&#39;</span>, <span style="color:#e6db74">&#39;https://api.spartan.com/v6/api/get_page/?route=spartan.training.wod&amp;secondary=spartan-wod&amp;primary=1&#39;</span>, <span style="color:#66d9ef">true</span>);

  <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">200</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">400</span>) {
      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">responseText</span>);
      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">dayOfWeek</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">new</span> Date()).<span style="color:#a6e22e">getDay</span>();
      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">workoutHtml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">wods</span>[<span style="color:#a6e22e">dayOfWeek</span>].<span style="color:#a6e22e">post_content</span>;
      <span style="color:#a6e22e">workoutHtml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">workoutHtml</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;jpg&#39;</span>).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;x&#39;</span>);
      <span style="color:#a6e22e">workoutHtml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">workoutHtml</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;png&#39;</span>).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;x&#39;</span>);
      document.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">workoutHtml</span>);
      document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#e6db74">&#39;img&#39;</span>).<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">i</span>) =&gt; { <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">remove</span>(); });
    }
  };

  <span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">send</span>();
  &lt;/<span style="color:#f92672">script</span>&gt;
&lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><p>And that&rsquo;s it. Add it to a webpage or mobile app and you&rsquo;ve got free, performance-optimized API content.</p>

    </div>

    
        <div class="tags">
            
                <a href="http://example.org/tags/projects">projects</a>
            
                <a href="http://example.org/tags/api">api</a>
            
                <a href="http://example.org/tags/lifehacking">lifehacking</a>
            
                <a href="http://example.org/tags/web">web</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    

    <div class="copyright">
    
       © Copyright 
       2022 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       
    
    </div>

    
      <div class="powerby">
        Powered by <a href='http://www.gohugo.io/'>Hugo</a> Theme By <a href='https://https://github.com/nodejh/hugo-theme-mini'>nodejh</a>
      </div>
    
</footer>



  </body>
</html>
